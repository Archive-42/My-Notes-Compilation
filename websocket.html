<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      window.currentUser = null;
    </script>
    <script>
      window.rateUsdToNative = 1;
    </script>
    <title itemprop="name">WebSocket</title>
    <link href="pack/styles.93b05845f313a968119b.css" rel="stylesheet" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script>
      if (window.devicePixelRatio > 1)
        document.cookie =
          "pixelRatio=" +
          window.devicePixelRatio +
          ";path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT";
    </script>
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:bold,italic,bolditalic"
      rel="stylesheet"
    />
    <link
      rel="apple-touch-icon-precomposed"

    <link rel="canonical" href="websocket.html" />
    <meta name="msapplication-TileColor" content="#222A2C" />
    <meta name="msapplication-TileImage" content="/img/favicon/tileicon.png" />
    <link rel="icon" href="img/favicon/favicon.png" />
    <meta
      itemprop="image"
      content="https://javascript.info/img/site_preview_en_512x512.png"
    />
    <meta property="og:title" content="WebSocket" />
    <meta
      property="og:image"
      content="https://javascript.info/img/site_preview_en_1200x630.png"
    />
    <meta property="og:image:type" content="image/png" />

    <meta name="twitter:title" content="WebSocket" />
    <meta name="twitter:site" content="@iliakan" />
    <meta name="twitter:creator" content="@iliakan" />

    <link rel="prev" href="long-polling.html" />
    <link rel="next" href="server-sent-events.html" />
    <script>
      window.GA_ID = "UA-2056213-15";
    </script>
    <script>
      window.YANDEX_METRIKA_ID = 32184394;
    </script>
    <script>
      (window.GoogleAnalyticsObject = "ga"),
        (window.ga = function () {
          window.ga.q.push(arguments);
        }),
        (window.ga.q = []),
        (window.ga.l = Date.now()),
        ga("create", GA_ID, "auto"),
        window.GTM_ID && ga("require", GTM_ID),
        window.currentUser
          ? ga("set", "&uid", currentUser.id)
          : ga("set", "anonymizeIp", !0),
        window.addEventListener("error", function (e) {
          var r = (e.filename || e.errorUrl) + ": " + (e.lineno || e.errorLine),
            n = e.stack || (e.error && e.error.stack);
          ga("send", "exception", {
            exDescription: e.message + " " + r + " " + n,
            exFatal: !0,
          });
        });
    </script>
    <script src="https://www.google-analytics.com/analytics.js" async></script>
    <script>
      ga("send", "pageview");
    </script>
    <script>
      (window.metrika = { reachGoal: function () {} }),
        (window.yandex_metrika_callbacks = [
          function () {
            try {
              (window.metrika = new Ya.Metrika({
                id: YANDEX_METRIKA_ID,
                webvisor: !0,
                clickmap: !0,
                params: { user: window.currentUser && window.currentUser.id },
              })),
                metrika.trackLinks({ delay: 150 }),
                window.addEventListener("error", function (r) {
                  window.metrika.reachGoal("JSERROR", {
                    src:
                      (r.filename || r.errorUrl) +
                      ": " +
                      (r.lineno || r.errorLine),
                    stack: r.stack || (r.error && r.error.stack),
                    message: r.message,
                  });
                });
            } catch (r) {}
          },
        ]);
    </script>
    <script src="https://mc.yandex.ru/metrika/watch.js" async></script>
    <script>
      window.RECAPTCHA_ID = "6LfmLAEVAAAAAJMykMnf7aY8nkyTRmYi2ynx51R1";
    </script>
    <script src="pack/init.810c8da2b4eed830d2da.js"></script>
    <script src="pack/head.282ce219a840c583fa6d.js" defer></script>
    <meta property="og:title" content="WebSocket" />
    <meta property="og:type" content="article" />
    <script src="pack/tutorial.dd771765a083d97231c4.js" defer></script>
    <script src="pack/footer.ce9ac5e9c03240648299.js" defer></script>
  </head>
  <body class="no-icons">

    <script>
          window.lang = "en";
        </script>
        <script>
          {
            let t = navigator.languages || [];
            t = t.map((t) => t.toLowerCase());
            let o,
              a,
              n = [];
            for (let o of window.langs)
              for (let a of t)
                if (a === o.code || a.startsWith(o.code + "-")) {
                  n.push(o);
                  break;
                }
            if ("en" === lang) {
              let t = n.find((t) => "en" != t.code);
              t &&
                "ru" != t.code &&
                ((o = `\n            According to your browser language headers, you know ${t.name}. Please help to <a href="https://github.com/javascript-tutorial/${t.code}.javascript.info#readme">translate the tutorial</a> into your language!\n            Thank you!\n          `),
                (a = "notify-translate-tutorial"));
            } else if ("ru" != lang) {
              n.find((t) => "en" == t.code) &&
                ((o = `\n            According to your browser headers, you know English. Please help to <a href="https://github.com/javascript-tutorial/${lang}.javascript.info#readme">translate the tutorial</a>.\n            Thank you!\n          `),
                (a = "notify-translate-tutorial-local"));
            }
            if (o) {
              let t = `<div class="notification notification_top notification_info sitetoolbar__notification" style="display:none" id="${a}">\n          <div class="notification__content">${o}</div>\n          <button class="notification__close" title="Close"></button>\n        </div>`;
              document.write(t), showTopNotification();
            }
          }
        </script>
        <div class="sitetoolbar__content">
          <div class="sitetoolbar__lang-switcher">
            <button class="sitetoolbar__dropdown-button" data-dropdown-toggler>
              EN
            </button>
            <div class="sitetoolbar__dropdown-wrap">
              <div class="sitetoolbar__dropdown-body">
                <div class="sitetoolbar__lang-switcher-body">
                  <div class="supported-langs supported-langs_toolbar">
                    <div class="supported-langs__container">
                      <ul class="supported-langs__list" style="height: 200px">
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://ar.javascript.info/"
                            ><span class="supported-langs__brief">AR</span
                            ><span >عربي</span></a
                          >
                        </li>
                        <li
                          class="
                            supported-langs__item supported-langs__item_current
                          "
                        >
                          <a class="supported-langs__link" href="websocket.html"
                            ><span class="supported-langs__brief">EN</span
                            ><span 
                              >English</span
                            ></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://es.javascript.info/websocket"
                            ><span class="supported-langs__brief">ES</span
                            ><span 
                              >Español</span
                            ></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://fr.javascript.info/websocket"
                            ><span class="supported-langs__brief">FR</span
                            ><span 
                              >Français</span
                            ></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://it.javascript.info/websocket"
                            ><span class="supported-langs__brief">IT</span
                            ><span 
                              >Italiano</span
                            ></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://ja.javascript.info/websocket"
                            ><span class="supported-langs__brief">JA</span
                            ><span 
                              >日本語</span
                            ></a
                          >
                        </li>
                      </ul>
                      <ul class="supported-langs__list" style="height: 128px">
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://ko.javascript.info/"
                            ><span class="supported-langs__brief">KO</span
                            ><span 
                              >한국어</span
                            ></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href=websocket"
                            ><span class="supported-langs__brief">RU</span
                            ><span 
                              >Русский</span
                            ></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://tr.javascript.info/websocket"
                            ><span class="supported-langs__brief">TR</span
                            ><span 
                              >Türkçe</span
                            ></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://zh.javascript.info/websocket"
                            ><span class="supported-langs__brief">ZH</span
                            ><span 
                              >简体中文</span
                            ></a
                          >
                        </li>
                      </ul>
                    </div>
                    <div class="supported-langs__text">
                      <p>
                        We want to make this open-source project available for
                        people all around the world.
                      </p>
                      <p>
                        <a href="translate.html">Help to translate</a> the
                        content of this tutorial to your language!
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="sitetoolbar__logo-wrap">
            <a
              class="sitetoolbar__link sitetoolbar__link_logo"
              href="index.html"
              ><img
                class="sitetoolbar__logo sitetoolbar__logo_normal"
                src="img/sitetoolbar__logo_en.svg"
                width="200"
                alt=""
                role="presentation"
              /><img
                class="sitetoolbar__logo sitetoolbar__logo_small"
                src="img/sitetoolbar__logo_small_en.svg"
                width="70"
                alt=""
                role="presentation"
              />
              <script>
                Array.prototype.forEach.call(
                  document.querySelectorAll("img.sitetoolbar__logo"),
                  function (e) {
                    let t = document.createElement("object");
                    (t.type = "image/svg+xml"),
                      (t.className = e.className),
                      (t.style.cssText = "left:0;top:0;position:absolute"),
                      (t.onload = function () {
                        (t.onload = null), (e.style.visibility = "hidden");
                      }),
                      (t.data = e.src),
                      e.parentNode.insertBefore(t, e);
                  }
                );
              </script></a
            >


              <form
                class="sitetoolbar__search"
                method="GET"
                action="https://javascript.info/search"
              >
                <button
                  class="sitetoolbar__search-toggle"
                  type="button"
                ></button>
                <div class="sitetoolbar__search-input">
                  <div class="text-input">
                    <input
                      class="text-input__control"
                      name="query"
                      placeholder="Search on Javascript.info"
                      required="required"
                      type="text"
                    />
                  </div>
                  <button class="sitetoolbar__find" type="submit">
                    Search
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="tablet-menu">
          <div class="tablet-menu__line">
            <div class="tablet-menu__content">
              <form
                class="tablet-menu-search"
                action="https://javascript.info/search/"
              >
                <input
                  class="tablet-menu-search__input"
                  type="search"
                  name="query"
                  placeholder="Search in the tutorial"
                  required="required"
                /><button
                  class="tablet-menu-search__button"
                  type="submit"
                  name="type"
                  value="articles"
                >
                  Search
                </button>
              </form>
            </div>
          </div>
          <div class="tablet-menu__line">
            <div class="tablet-menu__content">
              <div class="share-icons">
                <span class="share-icons__title">Share</span
                >2Fwebsocket"
                  rel="nofollow"
                ></a
                >2Fwebsocket"
                  rel="nofollow"
                ></a>
              </div>
            </div>
          </div>
          <div class="tablet-menu__line">
            <div class="tablet-menu__content">
              <select
                class="
                  tablet-menu__nav
                  input-select input-select input-select_small
                "
                onchange="if(this.value) window.location.href=this.value"
              >
                <option value="https://ar.javascript.info/">عربي</option>
                <option value="https://javascript.info/websocket" selected>
                  English
                </option>
                <option value="https://es.javascript.info/websocket">
                  Español
                </option>
                <option value="https://fr.javascript.info/websocket">
                  Français
                </option>
                <option value="https://it.javascript.info/websocket">
                  Italiano
                </option>
                <option value="https://ja.javascript.info/websocket">
                  日本語
                </option>
                <option value="https://ko.javascript.info/">한국어</option>
                <option value=websocket">
                  Русский
                </option>
                <option value="https://tr.javascript.info/websocket">
                  Türkçe
                </option>
                <option value="https://zh.javascript.info/websocket">
                  简体中文
                </option>
              </select>
            </div>
          </div>
        </div>
        <progress
          class="tutorial-progress"
          data-sticky
          value="11"
          max="12"
          data-tooltip="Lesson 11 of 12"
        ></progress>
      </div>
      <div class="page page_sidebar_on page_inner_padding">
        <script>
          if (localStorage.noSidebar) {
            document.querySelector(".page").classList.remove("page_sidebar_on");
            let e = document.querySelector(".page-wrapper");
            e && e.classList.remove("page-wrapper_sidebar_on");
          }
          setTimeout(function () {
            document
              .querySelector(".page")
              .classList.add("page_sidebar-animation-on");
          });
        </script>
        <div class="page__inner">
          <main class="main main_width-limit">
            <header class="main__header">
              <div class="main__header-inner">
                <div class="main__header-group">
                  <ol class="breadcrumbs">
                    <li class="breadcrumbs__item breadcrumbs__item_home">
                      <a class="breadcrumbs__link" href="index.html"
                        ><span class="breadcrumbs__hidden-text"
                          >Tutorial</span
                        ></a
                      >
                    </li>
                    <li class="breadcrumbs__item" id="breadcrumb-1">
                      <a class="breadcrumbs__link" href="network.html"
                        ><span>Network requests</span></a
                      >
                    </li>
                    <script type="application/ld+json">
                      {
                        "@context": "https://schema.org",
                        "@type": "BreadcrumbList",
                        "itemListElement": [
                          {
                            "@type": "ListItem",
                            "position": 1,
                            "name": "Tutorial",
                            "item": "https://javascript.info/"
                          },
                          {
                            "@type": "ListItem",
                            "position": 2,
                            "name": "Network requests",
                            "item": "https://javascript.info/network"
                          }
                        ]
                      }
                    </script>
                  </ol>
                  <div
                    class="updated-at"
                    data-tooltip="Last updated at 28th March 2021"
                  >
                    <div class="updated-at__content">28th March 2021</div>
                  </div>
                </div>
                <h1 class="main__header-title">WebSocket</h1>
              </div>
            </header>
            <div class="content">
              <article
                class="formatted"
                itemscope
                itemtype="http://schema.org/TechArticle"
              >
                <meta itemprop="name" content="WebSocket" />
                <div
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="email" content="iliakan@gmail.com" /><meta
                    itemprop="name"
                    content="Ilya Kantor"
                  />
                </div>
                <div itemprop="articleBody">
                  <p>
                    The <code>WebSocket</code> protocol, described in the
                    specification
                    <a href="http://tools.ietf.org/html/rfc6455">RFC 6455</a>
                    provides a way to exchange data between browser and server
                    via a persistent connection. The data can be passed in both
                    directions as “packets”, without breaking the connection and
                    additional HTTP-requests.
                  </p>
                  <p>
                    WebSocket is especially great for services that require
                    continuous data exchange, e.g. online games, real-time
                    trading systems and so on.
                  </p>
                  <h2>
                    <a
                      class="main__anchor"
                      name="a-simple-example"
                      href="websocket.html#a-simple-example"
                      >A simple example</a
                    >
                  </h2>
                  <p>
                    To open a websocket connection, we need to create
                    <code>new WebSocket</code> using the special protocol
                    <code>ws</code> in the url:
                  </p>
                  <div
                    id="vg25kxt60m"
                    data-trusted="1"
                    class="code-example"
                    data-highlight='[{"start":0,"cols":[{"start":28,"end":30}]}]'
                  >
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>let socket = new WebSocket(&quot;ws://javascript.info&quot;);</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    There’s also encrypted <code>wss://</code> protocol. It’s
                    like HTTPS for websockets.
                  </p>
                  <div class="important important_smart">
                    <div class="important__header">
                      <span class="important__type"
                        >Always prefer <code>wss://</code></span
                      >
                    </div>
                    <div class="important__content">
                      <p>
                        The <code>wss://</code> protocol is not only encrypted,
                        but also more reliable.
                      </p>
                      <p>
                        That’s because <code>ws://</code> data is not encrypted,
                        visible for any intermediary. Old proxy servers do not
                        know about WebSocket, they may see “strange” headers and
                        abort the connection.
                      </p>
                      <p>
                        On the other hand, <code>wss://</code> is WebSocket over
                        TLS, (same as HTTPS is HTTP over TLS), the transport
                        security layer encrypts the data at sender and decrypts
                        at the receiver. So data packets are passed encrypted
                        through proxies. They can’t see what’s inside and let
                        them through.
                      </p>
                    </div>
                  </div>
                  <p>
                    Once the socket is created, we should listen to events on
                    it. There are totally 4 events:
                  </p>
                  <ul>
                    <li>
                      <strong><code>open</code></strong> – connection
                      established,
                    </li>
                    <li>
                      <strong><code>message</code></strong> – data received,
                    </li>
                    <li>
                      <strong><code>error</code></strong> – websocket error,
                    </li>
                    <li>
                      <strong><code>close</code></strong> – connection closed.
                    </li>
                  </ul>
                  <p>
                    …And if we’d like to send something, then
                    <code>socket.send(data)</code> will do that.
                  </p>
                  <p>Here’s an example:</p>
                  <div id="xj1c092wb1" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="toolbar codebox__toolbar">
                        <div class="toolbar__tool">
                          <a
                            href="websocket.html#"
                            title="run"
                            data-action="run"
                            class="toolbar__button toolbar__button_run"
                          ></a>
                        </div>
                        <div class="toolbar__tool">
                          <a
                            href="websocket.html#"
                            title="open in sandbox"
                            target="_blank"
                            data-action="edit"
                            class="toolbar__button toolbar__button_edit"
                          ></a>
                        </div>
                      </div>
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>let socket = new WebSocket(&quot;wss://javascript.info/article/websocket/demo/hello&quot;);

socket.onopen = function(e) {
  alert(&quot;[open] Connection established&quot;);
  alert(&quot;Sending to server&quot;);
  socket.send(&quot;My name is John&quot;);
};

socket.onmessage = function(event) {
  alert(`[message] Data received from server: ${event.data}`);
};

socket.onclose = function(event) {
  if (event.wasClean) {
    alert(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
  } else {
    // e.g. server process killed or network down
    // event.code is usually 1006 in this case
    alert('[close] Connection died');
  }
};

socket.onerror = function(error) {
  alert(`[error] ${error.message}`);
};</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    For demo purposes, there’s a small server
                    <a href="article/websocket/demo/server.js">server.js</a>
                    written in Node.js, for the example above, running. It
                    responds with “Hello from server, John”, then waits 5
                    seconds and closes the connection.
                  </p>
                  <p>
                    So you’ll see events <code>open</code> →
                    <code>message</code> → <code>close</code>.
                  </p>
                  <p>
                    That’s actually it, we can talk WebSocket already. Quite
                    simple, isn’t it?
                  </p>
                  <p>Now let’s talk more in-depth.</p>
                  <h2>
                    <a
                      class="main__anchor"
                      name="opening-a-websocket"
                      href="websocket.html#opening-a-websocket"
                      >Opening a websocket</a
                    >
                  </h2>
                  <p>
                    When <code>new WebSocket(url)</code> is created, it starts
                    connecting immediately.
                  </p>
                  <p>
                    During the connection the browser (using headers) asks the
                    server: “Do you support Websocket?” And if the server
                    replies “yes”, then the talk continues in WebSocket
                    protocol, which is not HTTP at all.
                  </p>
                  <figure>
                    <div class="image" style="width: 429px">
                      <div
                        class="image__ratio"
                        style="padding-top: 81.11888111888112%"
                      ></div>
                      <object
                        type="image/svg+xml"
                        data="article/websocket/websocket-handshake.svg"
                        width="429"
                        height="348"
                        class="image__image"
                      >
                        <img
                          src="article/websocket/websocket-handshake.svg"
                          alt=""
                          width="429"
                          height="348"
                        />
                      </object>
                    </div>
                  </figure>
                  <p>
                    Here’s an example of browser headers for request made by
                    <code
                      >new
                      WebSocket(&quot;wss://javascript.info/chat&quot;)</code
                    >.
                  </p>
                  <div id="zgndh41qh7" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre class="line-numbers language-none"><code>GET /chat
Host: javascript.info
Origin: https://javascript.info
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Key: Iv8io/9s+lYFgZWcXczP8Q==
Sec-WebSocket-Version: 13</code></pre>
                      </div>
                    </div>
                  </div>
                  <ul>
                    <li>
                      <code>Origin</code> – the origin of the client page, e.g.
                      <code>https://javascript.info</code>. WebSocket objects
                      are cross-origin by nature. There are no special headers
                      or other limitations. Old servers are unable to handle
                      WebSocket anyway, so there are no compatibility issues.
                      But <code>Origin</code> header is important, as it allows
                      the server to decide whether or not to talk WebSocket with
                      this website.
                    </li>
                    <li>
                      <code>Connection: Upgrade</code> – signals that the client
                      would like to change the protocol.
                    </li>
                    <li>
                      <code>Upgrade: websocket</code> – the requested protocol
                      is “websocket”.
                    </li>
                    <li>
                      <code>Sec-WebSocket-Key</code> – a random
                      browser-generated key for security.
                    </li>
                    <li>
                      <code>Sec-WebSocket-Version</code> – WebSocket protocol
                      version, 13 is the current one.
                    </li>
                  </ul>
                  <div class="important important_smart">
                    <div class="important__header">
                      <span class="important__type"
                        >WebSocket handshake can’t be emulated</span
                      >
                    </div>
                    <div class="important__content">
                      <p>
                        We can’t use <code>XMLHttpRequest</code> or
                        <code>fetch</code> to make this kind of HTTP-request,
                        because JavaScript is not allowed to set these headers.
                      </p>
                    </div>
                  </div>
                  <p>
                    If the server agrees to switch to WebSocket, it should send
                    code 101 response:
                  </p>
                  <div id="mmv5g903ip" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-none"
                        ><code>101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: hsBlbuDTkk24srzEOTBUlZAlC2g=</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    Here <code>Sec-WebSocket-Accept</code> is
                    <code>Sec-WebSocket-Key</code>, recoded using a special
                    algorithm. The browser uses it to make sure that the
                    response corresponds to the request.
                  </p>
                  <p>
                    Afterwards, the data is transfered using WebSocket protocol,
                    we’ll see its structure (“frames”) soon. And that’s not HTTP
                    at all.
                  </p>
                  <h3>
                    <a
                      class="main__anchor"
                      name="extensions-and-subprotocols"
                      href="websocket.html#extensions-and-subprotocols"
                      >Extensions and subprotocols</a
                    >
                  </h3>
                  <p>
                    There may be additional headers
                    <code>Sec-WebSocket-Extensions</code> and
                    <code>Sec-WebSocket-Protocol</code> that describe extensions
                    and subprotocols.
                  </p>
                  <p>For instance:</p>
                  <ul>
                    <li>
                      <p>
                        <code>Sec-WebSocket-Extensions: deflate-frame</code>
                        means that the browser supports data compression. An
                        extension is something related to transferring the data,
                        functionality that extends WebSocket protocol. The
                        header <code>Sec-WebSocket-Extensions</code> is sent
                        automatically by the browser, with the list of all
                        extensions it supports.
                      </p>
                    </li>
                    <li>
                      <p>
                        <code>Sec-WebSocket-Protocol: soap, wamp</code> means
                        that we’d like to transfer not just any data, but the
                        data in
                        <a href="http://en.wikipedia.org/wiki/SOAP">SOAP</a> or
                        WAMP (“The WebSocket Application Messaging Protocol”)
                        protocols. WebSocket subprotocols are registered in the
                        <a
                          href="http://www.iana.org/assignments/websocket/websocket.xml"
                          >IANA catalogue</a
                        >. So, this header describes data formats that we’re
                        going to use.
                      </p>
                      <p>
                        This optional header is set using the second parameter
                        of <code>new WebSocket</code>. That’s the array of
                        subprotocols, e.g. if we’d like to use SOAP or WAMP:
                      </p>
                      <div
                        id="bz9zm9b3zo"
                        data-trusted="1"
                        class="code-example"
                      >
                        <div class="codebox code-example__codebox">
                          <div class="codebox__code" data-code="1">
                            <pre
                              class="line-numbers language-javascript"
                            ><code>let socket = new WebSocket(&quot;wss://javascript.info/chat&quot;, [&quot;soap&quot;, &quot;wamp&quot;]);</code></pre>
                          </div>
                        </div>
                      </div>
                    </li>
                  </ul>
                  <p>
                    The server should respond with a list of protocols and
                    extensions that it agrees to use.
                  </p>
                  <p>For example, the request:</p>
                  <div
                    id="hqvs6kl5qa"
                    data-trusted="1"
                    class="code-example"
                    data-highlight='[{"start":7,"end":8}]'
                  >
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre class="line-numbers language-none"><code>GET /chat
Host: javascript.info
Upgrade: websocket
Connection: Upgrade
Origin: https://javascript.info
Sec-WebSocket-Key: Iv8io/9s+lYFgZWcXczP8Q==
Sec-WebSocket-Version: 13
Sec-WebSocket-Extensions: deflate-frame
Sec-WebSocket-Protocol: soap, wamp</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>Response:</p>
                  <div
                    id="czb9z7tlzj"
                    data-trusted="1"
                    class="code-example"
                    data-highlight='[{"start":4,"end":5}]'
                  >
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-none"
                        ><code>101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: hsBlbuDTkk24srzEOTBUlZAlC2g=
Sec-WebSocket-Extensions: deflate-frame
Sec-WebSocket-Protocol: soap</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    Here the server responds that it supports the extension
                    “deflate-frame”, and only SOAP of the requested
                    subprotocols.
                  </p>
                  <h2>
                    <a
                      class="main__anchor"
                      name="data-transfer"
                      href="websocket.html#data-transfer"
                      >Data transfer</a
                    >
                  </h2>
                  <p>
                    WebSocket communication consists of “frames” – data
                    fragments, that can be sent from either side, and can be of
                    several kinds:
                  </p>
                  <ul>
                    <li>
                      “text frames” – contain text data that parties send to
                      each other.
                    </li>
                    <li>
                      “binary data frames” – contain binary data that parties
                      send to each other.
                    </li>
                    <li>
                      “ping/pong frames” are used to check the connection, sent
                      from the server, the browser responds to these
                      automatically.
                    </li>
                    <li>
                      there’s also “connection close frame” and a few other
                      service frames.
                    </li>
                  </ul>
                  <p>
                    In the browser, we directly work only with text or binary
                    frames.
                  </p>
                  <p>
                    <strong
                      >WebSocket <code>.send()</code> method can send either
                      text or binary data.</strong
                    >
                  </p>
                  <p>
                    A call <code>socket.send(body)</code> allows
                    <code>body</code> in string or a binary format, including
                    <code>Blob</code>, <code>ArrayBuffer</code>, etc. No
                    settings required: just send it out in any format.
                  </p>
                  <p>
                    <strong
                      >When we receive the data, text always comes as string.
                      And for binary data, we can choose between
                      <code>Blob</code> and
                      <code>ArrayBuffer</code> formats.</strong
                    >
                  </p>
                  <p>
                    That’s set by <code>socket.binaryType</code> property, it’s
                    <code>&quot;blob&quot;</code> by default, so binary data
                    comes as <code>Blob</code> objects.
                  </p>
                  <p>
                    <a href="blob.html">Blob</a> is a high-level binary object,
                    it directly integrates with <code>&lt;a&gt;</code>,
                    <code>&lt;img&gt;</code> and other tags, so that’s a sane
                    default. But for binary processing, to access individual
                    data bytes, we can change it to
                    <code>&quot;arraybuffer&quot;</code>:
                  </p>
                  <div id="wm5m922z04" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>socket.binaryType = &quot;arraybuffer&quot;;
socket.onmessage = (event) =&gt; {
  // event.data is either a string (if text) or arraybuffer (if binary)
};</code></pre>
                      </div>
                    </div>
                  </div>
                  <h2>
                    <a
                      class="main__anchor"
                      name="rate-limiting"
                      href="websocket.html#rate-limiting"
                      >Rate limiting</a
                    >
                  </h2>
                  <p>
                    Imagine, our app is generating a lot of data to send. But
                    the user has a slow network connection, maybe on a mobile
                    internet, outside of a city.
                  </p>
                  <p>
                    We can call <code>socket.send(data)</code> again and again.
                    But the data will be buffered (stored) in memory and sent
                    out only as fast as network speed allows.
                  </p>
                  <p>
                    The <code>socket.bufferedAmount</code> property stores how
                    many bytes remain buffered at this moment, waiting to be
                    sent over the network.
                  </p>
                  <p>
                    We can examine it to see whether the socket is actually
                    available for transmission.
                  </p>
                  <div id="9yeuhzhnio" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>// every 100ms examine the socket and send more data
// only if all the existing data was sent out
setInterval(() =&gt; {
  if (socket.bufferedAmount == 0) {
    socket.send(moreData());
  }
}, 100);</code></pre>
                      </div>
                    </div>
                  </div>
                  <h2>
                    <a
                      class="main__anchor"
                      name="connection-close"
                      href="websocket.html#connection-close"
                      >Connection close</a
                    >
                  </h2>
                  <p>
                    Normally, when a party wants to close the connection (both
                    browser and server have equal rights), they send a
                    “connection close frame” with a numeric code and a textual
                    reason.
                  </p>
                  <p>The method for that is:</p>
                  <div id="gr27a1lol4" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>socket.close([code], [reason]);</code></pre>
                      </div>
                    </div>
                  </div>
                  <ul>
                    <li>
                      <code>code</code> is a special WebSocket closing code
                      (optional)
                    </li>
                    <li>
                      <code>reason</code> is a string that describes the reason
                      of closing (optional)
                    </li>
                  </ul>
                  <p>
                    Then the other party in <code>close</code> event handler
                    gets the code and the reason, e.g.:
                  </p>
                  <div id="py3dhy88zo" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>// closing party:
socket.close(1000, &quot;Work complete&quot;);

// the other party
socket.onclose = event =&gt; {
  // event.code === 1000
  // event.reason === &quot;Work complete&quot;
  // event.wasClean === true (clean close)
};</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>Most common code values:</p>
                  <ul>
                    <li>
                      <code>1000</code> – the default, normal closure (used if
                      no <code>code</code> supplied),
                    </li>
                    <li>
                      <code>1006</code> – no way to set such code manually,
                      indicates that the connection was lost (no close frame).
                    </li>
                  </ul>
                  <p>There are other codes like:</p>
                  <ul>
                    <li>
                      <code>1001</code> – the party is going away, e.g. server
                      is shutting down, or a browser leaves the page,
                    </li>
                    <li>
                      <code>1009</code> – the message is too big to process,
                    </li>
                    <li><code>1011</code> – unexpected error on server,</li>
                    <li>…and so on.</li>
                  </ul>
                  <p>
                    The full list can be found in
                    <a href="https://tools.ietf.org/html/rfc6455#section-7.4.1"
                      >RFC6455, §7.4.1</a
                    >.
                  </p>
                  <p>
                    WebSocket codes are somewhat like HTTP codes, but different.
                    In particular, any codes less than <code>1000</code> are
                    reserved, there’ll be an error if we try to set such a code.
                  </p>
                  <div id="bunxzneez8" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>// in case connection is broken
socket.onclose = event =&gt; {
  // event.code === 1006
  // event.reason === &quot;&quot;
  // event.wasClean === false (no closing frame)
};</code></pre>
                      </div>
                    </div>
                  </div>
                  <h2>
                    <a
                      class="main__anchor"
                      name="connection-state"
                      href="websocket.html#connection-state"
                      >Connection state</a
                    >
                  </h2>
                  <p>
                    To get connection state, additionally there’s
                    <code>socket.readyState</code> property with values:
                  </p>
                  <ul>
                    <li>
                      <strong><code>0</code></strong> – “CONNECTING”: the
                      connection has not yet been established,
                    </li>
                    <li>
                      <strong><code>1</code></strong> – “OPEN”: communicating,
                    </li>
                    <li>
                      <strong><code>2</code></strong> – “CLOSING”: the
                      connection is closing,
                    </li>
                    <li>
                      <strong><code>3</code></strong> – “CLOSED”: the connection
                      is closed.
                    </li>
                  </ul>
                  <h2>
                    <a
                      class="main__anchor"
                      name="chat-example"
                      href="websocket.html#chat-example"
                      >Chat example</a
                    >
                  </h2>
                  <p>
                    Let’s review a chat example using browser WebSocket API and
                    Node.js WebSocket module
                    <a href="https://github.com/websockets/ws"
                      >https://github.com/websockets/ws</a
                    >. We’ll pay the main attention to the client side, but the
                    server is also simple.
                  </p>
                  <p>
                    HTML: we need a <code>&lt;form&gt;</code> to send messages
                    and a <code>&lt;div&gt;</code> for incoming messages:
                  </p>
                  <div id="lctdwa73c5" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-markup"
                        ><code>&lt;!-- message form --&gt;
&lt;form name=&quot;publish&quot;&gt;
  &lt;input type=&quot;text&quot; name=&quot;message&quot;&gt;
  &lt;input type=&quot;submit&quot; value=&quot;Send&quot;&gt;
&lt;/form&gt;

&lt;!-- div with messages --&gt;
&lt;div id=&quot;messages&quot;&gt;&lt;/div&gt;</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>From JavaScript we want three things:</p>
                  <ol>
                    <li>Open the connection.</li>
                    <li>
                      On form submission – <code>socket.send(message)</code> for
                      the message.
                    </li>
                    <li>
                      On incoming message – append it to
                      <code>div#messages</code>.
                    </li>
                  </ol>
                  <p>Here’s the code:</p>
                  <div id="cgx7iv36wm" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>let socket = new WebSocket(&quot;wss://javascript.info/article/websocket/chat/ws&quot;);

// send message from the form
document.forms.publish.onsubmit = function() {
  let outgoingMessage = this.message.value;

  socket.send(outgoingMessage);
  return false;
};

// message received - show the message in div#messages
socket.onmessage = function(event) {
  let message = event.data;

  let messageElem = document.createElement('div');
  messageElem.textContent = message;
  document.getElementById('messages').prepend(messageElem);
}</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    Server-side code is a little bit beyond our scope. Here
                    we’ll use Node.js, but you don’t have to. Other platforms
                    also have their means to work with WebSocket.
                  </p>
                  <p>The server-side algorithm will be:</p>
                  <ol>
                    <li>
                      Create <code>clients = new Set()</code> – a set of
                      sockets.
                    </li>
                    <li>
                      For each accepted websocket, add it to the set
                      <code>clients.add(socket)</code> and setup
                      <code>message</code> event listener to get its messages.
                    </li>
                    <li>
                      When a message received: iterate over clients and send it
                      to everyone.
                    </li>
                    <li>
                      When a connection is closed:
                      <code>clients.delete(socket)</code>.
                    </li>
                  </ol>
                  <div id="z5a2qkq65g" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>const ws = new require('ws');
const wss = new ws.Server({noServer: true});

const clients = new Set();

http.createServer((req, res) =&gt; {
  // here we only handle websocket connections
  // in real project we'd have some other code here to handle non-websocket requests
  wss.handleUpgrade(req, req.socket, Buffer.alloc(0), onSocketConnect);
});

function onSocketConnect(ws) {
  clients.add(ws);

  ws.on('message', function(message) {
    message = message.slice(0, 50); // max message length will be 50

    for(let client of clients) {
      client.send(message);
    }
  });

  ws.on('close', function() {
    clients.delete(ws);
  });
}</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>Here’s the working example:</p>
                  <div class="code-result">
                    <div class="code-result__toolbar toolbar">
                      <div class="toolbar__tool">
                        <a
                          href="tutorial/zipview/chat.zip%3FplunkId=IhFPn8rKBriAIsNc"
                          target="_blank"
                          title="download as zip"
                          class="toolbar__button toolbar__button_download"
                        ></a>
                      </div>
                    </div>
                    <iframe
                      class="code-result__iframe"
                      data-trusted="1"
                      style="height: 100px"
                      src="https://en.js.cx/article/websocket/chat/"
                    ></iframe>
                  </div>
                  <p>
                    You can also download it (upper-right button in the iframe)
                    and run locally. Just don’t forget to install
                    <a href="https://nodejs.org/en/">Node.js</a> and
                    <code>npm install ws</code> before running.
                  </p>
                  <h2>
                    <a
                      class="main__anchor"
                      name="summary"
                      href="websocket.html#summary"
                      >Summary</a
                    >
                  </h2>
                  <p>
                    WebSocket is a modern way to have persistent browser-server
                    connections.
                  </p>
                  <ul>
                    <li>WebSockets don’t have cross-origin limitations.</li>
                    <li>They are well-supported in browsers.</li>
                    <li>Can send/receive strings and binary data.</li>
                  </ul>
                  <p>The API is simple.</p>
                  <p>Methods:</p>
                  <ul>
                    <li><code>socket.send(data)</code>,</li>
                    <li><code>socket.close([code], [reason])</code>.</li>
                  </ul>
                  <p>Events:</p>
                  <ul>
                    <li><code>open</code>,</li>
                    <li><code>message</code>,</li>
                    <li><code>error</code>,</li>
                    <li><code>close</code>.</li>
                  </ul>
                  <p>
                    WebSocket by itself does not include reconnection,
                    authentication and many other high-level mechanisms. So
                    there are client/server libraries for that, and it’s also
                    possible to implement these capabilities manually.
                  </p>
                  <p>
                    Sometimes, to integrate WebSocket into existing project,
                    people run WebSocket server in parallel with the main
                    HTTP-server, and they share a single database. Requests to
                    WebSocket use <code>wss://ws.site.com</code>, a subdomain
                    that leads to WebSocket server, while
                    <code>https://site.com</code> goes to the main HTTP-server.
                  </p>
                  <p>Surely, other ways of integration are also possible.</p>
                </div>
              </article>
            </div>
            <div class="page__nav-wrap">
              <a
                class="page__nav page__nav_prev"
                href="long-polling.html"
                data-tooltip="Long polling"
                ><span class="page__nav-text"
                  ><span class="page__nav-text-shortcut"></span></span
                ><span class="page__nav-text-alternate"
                  >Previous lesson</span
                ></a
              ><a
                class="page__nav page__nav_next"
                href="server-sent-events.html"
                data-tooltip="Server Sent Events"
                ><span class="page__nav-text"
                  ><span class="page__nav-text-shortcut"></span></span
                ><span class="page__nav-text-alternate">Next lesson</span></a
              >
            </div>
            <div class="article-tablet-foot tablet-only">
              <div class="article-tablet-foot__layout">
                <div class="share-icons">
                  <span class="share-icons__title">Share</span
                  ><a
                    class="share share_tw"
                    s%3A%2F%2Fjavascript.info%2Fwebsocket"
                    rel="nofollow"
                  ></a
                  ><a
                    class="share share_fb"
                    href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fwebsocket"
                    rel="nofollow"
                  ></a>
                </div>
                <div class="article-tablet-foot__map">
                  <a
                    class="map"
                    href="tutorial/map.html"
                    data-action="tutorial-map"
                    ><span class="map__text">Tutorial map</span></a
                  >
                </div>
              </div>
            </div>
            
                  <a href="websocket.html#comments" name="comments">Comments</a>
                </h2>
                <div class="comments__read-before">
                  <span class="comments__read-before-link"
                    >read this before commenting…</span
                  >
                  <div class="comments__read-before-popup">
                    <div class="comments__read-before-popup-i">
                      <ul>
                        <li>
                          If you have suggestions what to improve - please
                          <a
                            href="https://github.com/javascript-tutorial/en.javascript.info/issues/new"
                            >submit a GitHub issue</a
                          >
                          or a pull request instead of commenting.
                        </li>
                        <li>
                          If you can't understand something in the article –
                          please elaborate.
                        </li>
                        <li>
                          To insert few words of code, use the
                          <code>&lt;code&gt;</code> tag, for several lines –
                          wrap them in <code>&lt;pre&gt;</code> tag, for more
                          than 10 lines – use a sandbox (<a
                            href="https://plnkr.co/edit/?p=preview"
                            >plnkr</a
                          >, <a href="https://jsbin.com">jsbin</a>,
                          <a href="http://codepen.io">codepen</a>…)
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <div id="disqus_thread"></div>
              <script>
                var disqus_config = function () {
                  if (!this.page) this.page = {};
                  Object.assign(this.page, {
                    url: "https:\/\/javascript.info\/websocket",
                    identifier: "\/websocket",
                  });
                };
              </script>
              <script>
                var disqus_shortname = "javascriptinfo";
              </script>
              <script>
                var disqus_enabled = true;
              </script>
            </div>
          </main>
        </div>

                <nav class="sidebar__navigation">
                  <ul class="sidebar__navigation-links">
                    <li class="sidebar__navigation-link">
                      <a class="sidebar__link" href="network.html"
                        >Network requests</a
                      >
                    </li>
                  </ul>
                </nav>
                <h4 class="sidebar__section-title">Lesson navigation</h4>
                <nav class="sidebar__navigation">
                  <ul class="sidebar__navigation-links">
                    <li class="sidebar__navigation-link">
                   websocket.html#a-simple-example"
                        >A simple example</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   websocket.html#opening-a-websocket"
                        >Opening a websocket</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   websocket.html#data-transfer"
                        >Data transfer</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   websocket.html#rate-limiting"
                        >Rate limiting</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   websocket.html#connection-close"
                        >Connection close</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   websocket.html#connection-state"
                        >Connection state</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   websocket.html#chat-example"
                        >Chat example</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                      <a class="sidebar__link" href="websocket.html
                  </ul>
                </nav>
                <nav class="sidebar__navigation">
                  <ul class="sidebar__navigation-links">
                    <li class="sidebar__navigation-link">
                      <a class="sidebar__link" href="websocket.html#comments"
                        >Comments</a
                      >
                    </li>
                  </ul>
                </nav>
              </div>
           <a
                  class="share share_tw sidebar__share"
                  s%3A%2F%2Fjavascript.info%2Fwebsocket"
                  rel="nofollow"
                ></a
                ><a
                  class="share share_fb sidebar__share"
                  href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Fjavascript.info%2Fwebsocket"
                  rel="nofollow"
                ></a>
                <a
                  class="sidebar__link"
                  href="https://github.com/javascript-tutorial/en.javascript.info/blob/master/5-network/11-websocket"
                  rel="nofollow"
                  >Edit on GitHub</a
                >
              </div>
              <div class="sidebar__section" id="sponsorBar">
                <div class="sidebar__section-title" id="sponsorBarTitle"></div>
                <div id="sponsorBarContent"></div>
                <script>
                  window.initSponsorBar();
                </script>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="page-footer">
      <ul class="page-footer__list">
        <li class="page-footer__item page-footer__item_copy">
          ©&nbsp;2007—2021&nbsp; Ilya Kantor
        </li>
        <li class="page-footer__item page-footer__item_about">
          <a class="page-footer__link" href="about.html">about the project</a>
        </li>
        <li class="page-footer__item page-footer__item_contact">
          <a class="page-footer__link" href="about.html#contact-us"
            >contact us</a
          >
        </li>
        <li class="page-footer__item page-footer__item_terms">
          <a class="page-footer__link" href="terms.html">terms of usage</a>
        </li>
        <li class="page-footer__item page-footer__item_privacy">
          <a class="page-footer__link" href="privacy.html">privacy policy</a>
        </li>
      </ul>
    </div>
  </body>
</html>
