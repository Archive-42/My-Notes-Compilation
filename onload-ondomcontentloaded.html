<!DOCTYPE html>
<html lang="en">
  <head>
    <script>
      window.currentUser = null;
    </script>
    <script>
      window.rateUsdToNative = 1;
    </script>
    <title itemprop="name">
      Page: DOMContentLoaded, load, beforeunload, unload
    </title>
    <link href="pack/styles.93b05845f313a968119b.css" rel="stylesheet" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script>
      if (window.devicePixelRatio > 1)
        document.cookie =
          "pixelRatio=" +
          window.devicePixelRatio +
          ";path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT";
    </script>
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:bold,italic,bolditalic"
      rel="stylesheet"
    />
    <link
      rel="apple-touch-icon-precomposed"
      <link
      rel="canonical"
      href="onload-ondomcontentloaded.html"
    />
    <meta name="msapplication-TileColor" content="#222A2C" />
    <meta name="msapplication-TileImage" content="/img/favicon/tileicon.png" />
    <link rel="icon" href="img/favicon/favicon.png" />
    <meta
      itemprop="image"
      content="https://javascript.info/img/site_preview_en_512x512.png"
    />
    <meta
      property="og:title"
      content="Page: DOMContentLoaded, load, beforeunload, unload"
    />
    <meta
      property="og:image"
      content="https://javascript.info/img/site_preview_en_1200x630.png"
    />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="fb:admins" content="100001562528165" />
    <meta name="twitter:card" content="summary" />
    <meta
      name="twitter:title"
      content="Page: DOMContentLoaded, load, beforeunload, unload"
    />
    <meta name="twitter:site" content="@iliakan" />
    <meta name="twitter:creator" content="@iliakan" />

    <link rel="prev" href="loading.html" />
    <link rel="next" href="script-async-defer.html" />
    <script>
      window.GA_ID = "UA-2056213-15";
    </script>
    <script>
      window.YANDEX_METRIKA_ID = 32184394;
    </script>

    <script src="https://www.google-analytics.com/analytics.js" async></script>
    <script>
      ga("send", "pageview");
    </script>
    <script>
      (window.metrika = { reachGoal: function () {} }),
        (window.yandex_metrika_callbacks = [
          function () {
            try {
              (window.metrika = new Ya.Metrika({
                id: YANDEX_METRIKA_ID,
                webvisor: !0,
                clickmap: !0,
                params: { user: window.currentUser && window.currentUser.id },
              })),
                metrika.trackLinks({ delay: 150 }),
                window.addEventListener("error", function (r) {
                  window.metrika.reachGoal("JSERROR", {
                    src:
                      (r.filename || r.errorUrl) +
                      ": " +
                      (r.lineno || r.errorLine),
                    stack: r.stack || (r.error && r.error.stack),
                    message: r.message,
                  });
                });
            } catch (r) {}
          },
        ]);
    </script>
    <script src="https://mc.yandex.ru/metrika/watch.js" async></script>
    <script>
      window.RECAPTCHA_ID = "6LfmLAEVAAAAAJMykMnf7aY8nkyTRmYi2ynx51R1";
    </script>
    <script src="pack/init.810c8da2b4eed830d2da.js"></script>
    <script src="pack/head.282ce219a840c583fa6d.js" defer></script>
    <meta
      property="og:title"
      content="Page: DOMContentLoaded, load, beforeunload, unload"
    />
    <meta property="og:type" content="article" />
    <script src="pack/tutorial.dd771765a083d97231c4.js" defer></script>
    <script src="pack/footer.ce9ac5e9c03240648299.js" defer></script>
  </head>
  <body class="no-icons">

    <script>
          window.lang = "en";
        </script>
        <script>
          {
            let t = navigator.languages || [];
            t = t.map((t) => t.toLowerCase());
            let o,
              a,
              n = [];
            for (let o of window.langs)
              for (let a of t)
                if (a === o.code || a.startsWith(o.code + "-")) {
                  n.push(o);
                  break;
                }
            if ("en" === lang) {
              let t = n.find((t) => "en" != t.code);
              t &&
                "ru" != t.code &&
                ((o = `\n            According to your browser language headers, you know ${t.name}. Please help to <a href="https://github.com/javascript-tutorial/${t.code}.javascript.info#readme">translate the tutorial</a> into your language!\n            Thank you!\n          `),
                (a = "notify-translate-tutorial"));
            } else if ("ru" != lang) {
              n.find((t) => "en" == t.code) &&
                ((o = `\n            According to your browser headers, you know English. Please help to <a href="https://github.com/javascript-tutorial/${lang}.javascript.info#readme">translate the tutorial</a>.\n            Thank you!\n          `),
                (a = "notify-translate-tutorial-local"));
            }
            if (o) {
              let t = `<div class="notification notification_top notification_info sitetoolbar__notification" style="display:none" id="${a}">\n          <div class="notification__content">${o}</div>\n          <button class="notification__close" title="Close"></button>\n        </div>`;
              document.write(t), showTopNotification();
            }
          }
        </script>
        <div class="sitetoolbar__content">
          <div class="sitetoolbar__lang-switcher">
            <button class="sitetoolbar__dropdown-button" data-dropdown-toggler>
              EN
            </button>
            <div class="sitetoolbar__dropdown-wrap">
              <div class="sitetoolbar__dropdown-body">
                <div class="sitetoolbar__lang-switcher-body">
                  <div class="supported-langs supported-langs_toolbar">
                    <div class="supported-langs__container">
                      <ul class="supported-langs__list" style="height: 200px">
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://ar.javascript.info/onload-ondomcontentloaded"
                            ><span class="supported-langs__brief">AR</span
                            ><span>عربي</span></a
                          >
                        </li>
                        <li
                          class="
                            supported-langs__item supported-langs__item_current
                          "
                        >
                          <a
                            class="supported-langs__link"
                            href="onload-ondomcontentloaded.html"
                            ><span class="supported-langs__brief">EN</span
                            ><span>English</span></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://es.javascript.info/onload-ondomcontentloaded"
                            ><span class="supported-langs__brief">ES</span
                            ><span>Español</span></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://fr.javascript.info/onload-ondomcontentloaded"
                            ><span class="supported-langs__brief">FR</span
                            ><span>Français</span></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://it.javascript.info/onload-ondomcontentloaded"
                            ><span class="supported-langs__brief">IT</span
                            ><span>Italiano</span></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://ja.javascript.info/onload-ondomcontentloaded"
                            ><span class="supported-langs__brief">JA</span
                            ><span>日本語</span></a
                          >
                        </li>
                      </ul>
                      <ul class="supported-langs__list" style="height: 128px">
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://ko.javascript.info/onload-ondomcontentloaded"
                            ><span class="supported-langs__brief">KO</span
                            ><span>한국어</span></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href=onload-ondomcontentloaded"
                            ><span class="supported-langs__brief">RU</span
                            ><span>Русский</span></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://tr.javascript.info/"
                            ><span class="supported-langs__brief">TR</span
                            ><span>Türkçe</span></a
                          >
                        </li>
                        <li class="supported-langs__item">
                          <a
                            class="supported-langs__link"
                            href="https://zh.javascript.info/onload-ondomcontentloaded"</a
            >


              <form
                class="sitetoolbar__search"
                method="GET"
                action="https://javascript.info/search"
              >
                <button
                  class="sitetoolbar__search-toggle"
                  type="button"
                ></button>
                <div class="sitetoolbar__search-input">
                  <div class="text-input">
                    <input
                      class="text-input__control"
                      name="query"
                      placeholder="Search on Javascript.info"
                      required="required"
                      type="text"
                    />
                  </div>
                  <button class="sitetoolbar__find" type="submit">
                    Search
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

          <div class="tablet-menu__line">
            <div class="tablet-menu__content">
              <div class="share-icons">
                <span class="share-icons__title">Share</span
                >2Fonload-ondomcontentloaded"
                  rel="nofollow"
                ></a
                >2Fonload-ondomcontentloaded"
                  rel="nofollow"
                ></a>
              </div>
            </div>
          </div>
          <div class="tablet-menu__line">
            <div class="tablet-menu__content">
              <select
                class="
                  tablet-menu__nav
                  input-select input-select input-select_small
                "
                onchange="if(this.value) window.location.href=this.value"
              >
                <option
                  value="https://ar.javascript.info/onload-ondomcontentloaded"
                >
                  عربي
                </option>
                <option
                  value="https://javascript.info/onload-ondomcontentloaded"
                  selected
                >
                  English
                </option>
                <option
                  value="https://es.javascript.info/onload-ondomcontentloaded"
                >
                  Español
                </option>
                <option
                  value="https://fr.javascript.info/onload-ondomcontentloaded"
                >
                  Français
                </option>
                <option
                  value="https://it.javascript.info/onload-ondomcontentloaded"
                >
                  Italiano
                </option>
                <option
                  value="https://ja.javascript.info/onload-ondomcontentloaded"
                >
                  日本語
                </option>
                <option
                  value="https://ko.javascript.info/onload-ondomcontentloaded"
                >
                  한국어
                </option>
                <option
                  value=onload-ondomcontentloaded"
                >
                  Русский
                </option>
                <option value="https://tr.javascript.info/">Türkçe</option>
                <option
                  value="https://zh.javascript.info/onload-ondomcontentloaded"
   
              </select>
            </div>
          </div>
        </div>
        <progress
          class="tutorial-progress"
          data-sticky
          value="27"
          max="32"
          data-tooltip="Lesson 27 of 32"
        ></progress>
      </div>
      <div class="page page_sidebar_on page_inner_padding">
        <script>
          if (localStorage.noSidebar) {
            document.querySelector(".page").classList.remove("page_sidebar_on");
            let e = document.querySelector(".page-wrapper");
            e && e.classList.remove("page-wrapper_sidebar_on");
          }
          setTimeout(function () {
            document
              .querySelector(".page")
              .classList.add("page_sidebar-animation-on");
          });
        </script>
        <div class="page__inner">
          <main class="main main_width-limit">
            <header class="main__header">
              <div class="main__header-inner">
                <div class="main__header-group">
                  <ol class="breadcrumbs">
                    <li class="breadcrumbs__item breadcrumbs__item_home">
                      <a class="breadcrumbs__link" href="index.html"
                        ><span class="breadcrumbs__hidden-text"
                          >Tutorial</span
                        ></a
                      >
                    </li>
                    <li class="breadcrumbs__item" id="breadcrumb-1">
                      <a class="breadcrumbs__link" href="ui.html"
                        ><span>Browser: Document, Events, Interfaces</span></a
                      >
                    </li>
                    <li class="breadcrumbs__item" id="breadcrumb-2">
                      <a class="breadcrumbs__link" href="loading.html"
                        ><span>Document and resource loading</span></a
                      >
                    </li>
                    <script type="application/ld+json">
                      {
                        "@context": "https://schema.org",
                        "@type": "BreadcrumbList",
                        "itemListElement": [
                          {
                            "@type": "ListItem",
                            "position": 1,
                            "name": "Tutorial",
                            "item": "https://javascript.info/"
                          },
                          {
                            "@type": "ListItem",
                            "position": 2,
                            "name": "Browser: Document, Events, Interfaces",
                            "item": "https://javascript.info/ui"
                          },
                          {
                            "@type": "ListItem",
                            "position": 3,
                            "name": "Document and resource loading",
                            "item": "https://javascript.info/loading"
                          }
                        ]
                      }
                    </script>
                  </ol>
                  <div
                    class="updated-at"
                    data-tooltip="Last updated at 23rd July 2021"
                  >
                    <div class="updated-at__content">23rd July 2021</div>
                  </div>
                </div>
                <h1 class="main__header-title">
                  Page: DOMContentLoaded, load, beforeunload, unload
                </h1>
              </div>
            </header>
            <div class="content">
              <article
                class="formatted"
                itemscope
                itemtype="http://schema.org/TechArticle"
              >
                <meta
                  itemprop="name"
                  content="Page: DOMContentLoaded, load, beforeunload, unload"
                />
                <div
                  itemprop="author"
                  itemscope
                  itemtype="http://schema.org/Person"
                >
                  <meta itemprop="email" content="iliakan@gmail.com" /><meta
                    itemprop="name"
                    content="Ilya Kantor"
                  />
                </div>
                <div itemprop="articleBody">
                  <p>
                    The lifecycle of an HTML page has three important events:
                  </p>
                  <ul>
                    <li>
                      <code>DOMContentLoaded</code> – the browser fully loaded
                      HTML, and the DOM tree is built, but external resources
                      like pictures <code>&lt;img&gt;</code> and stylesheets may
                      not yet have loaded.
                    </li>
                    <li>
                      <code>load</code> – not only HTML is loaded, but also all
                      the external resources: images, styles etc.
                    </li>
                    <li>
                      <code>beforeunload/unload</code> – the user is leaving the
                      page.
                    </li>
                  </ul>
                  <p>Each event may be useful:</p>
                  <ul>
                    <li>
                      <code>DOMContentLoaded</code> event – DOM is ready, so the
                      handler can lookup DOM nodes, initialize the interface.
                    </li>
                    <li>
                      <code>load</code> event – external resources are loaded,
                      so styles are applied, image sizes are known etc.
                    </li>
                    <li>
                      <code>beforeunload</code> event – the user is leaving: we
                      can check if the user saved the changes and ask them
                      whether they really want to leave.
                    </li>
                    <li>
                      <code>unload</code> – the user almost left, but we still
                      can initiate some operations, such as sending out
                      statistics.
                    </li>
                  </ul>
                  <p>Let’s explore the details of these events.</p>
                  <h2>
                    <a
                      class="main__anchor"
                      name="domcontentloaded"
                      href="onload-ondomcontentloaded.html#domcontentloaded"
                      >DOMContentLoaded</a
                    >
                  </h2>
                  <p>
                    The <code>DOMContentLoaded</code> event happens on the
                    <code>document</code> object.
                  </p>
                  <p>We must use <code>addEventListener</code> to catch it:</p>
                  <div id="sbc262ueek" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>document.addEventListener(&quot;DOMContentLoaded&quot;, ready);
// not &quot;document.onDOMContentLoaded = ...&quot;</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>For instance:</p>
                  <div
                    id="id2x0f6k3y"
                    data-trusted="1"
                    class="code-example"
                    data-demo-height="200"
                    data-refresh="1"
                    data-highlight='[{"start":8,"end":8}]'
                  >
                    <div class="codebox code-example__codebox">
                      <div class="toolbar codebox__toolbar">
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="show"
                            data-action="run"
                            class="toolbar__button toolbar__button_run"
                          ></a>
                        </div>
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="open in sandbox"
                            target="_blank"
                            data-action="edit"
                            class="toolbar__button toolbar__button_edit"
                          ></a>
                        </div>
                      </div>
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-markup"
                        ><code>&lt;script&gt;
  function ready() {
    alert('DOM is ready');

    // image is not yet loaded (unless it was cached), so the size is 0x0
    alert(`Image size: ${img.offsetWidth}x${img.offsetHeight}`);
  }

  document.addEventListener(&quot;DOMContentLoaded&quot;, ready);
&lt;/script&gt;

&lt;img id=&quot;img&quot; src=&quot;https://en.js.cx/clipart/train.gif?speed=1&amp;cache=0&quot;&gt;</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    In the example, the <code>DOMContentLoaded</code> handler
                    runs when the document is loaded, so it can see all the
                    elements, including <code>&lt;img&gt;</code> below.
                  </p>
                  <p>
                    But it doesn’t wait for the image to load. So
                    <code>alert</code> shows zero sizes.
                  </p>
                  <p>
                    At first sight, the <code>DOMContentLoaded</code> event is
                    very simple. The DOM tree is ready – here’s the event. There
                    are few peculiarities though.
                  </p>
                  <h3>
                    <a
                      class="main__anchor"
                      name="domcontentloaded-and-scripts"
                      href="onload-ondomcontentloaded.html#domcontentloaded-and-scripts"
                      >DOMContentLoaded and scripts</a
                    >
                  </h3>
                  <p>
                    When the browser processes an HTML-document and comes across
                    a <code>&lt;script&gt;</code> tag, it needs to execute
                    before continuing building the DOM. That’s a precaution, as
                    scripts may want to modify DOM, and even
                    <code>document.write</code> into it, so
                    <code>DOMContentLoaded</code> has to wait.
                  </p>
                  <p>
                    So DOMContentLoaded definitely happens after such scripts:
                  </p>
                  <div id="f7xx69gpkk" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="toolbar codebox__toolbar">
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="show"
                            data-action="run"
                            class="toolbar__button toolbar__button_run"
                          ></a>
                        </div>
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="open in sandbox"
                            target="_blank"
                            data-action="edit"
                            class="toolbar__button toolbar__button_edit"
                          ></a>
                        </div>
                      </div>
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-markup"
                        ><code>&lt;script&gt;
  document.addEventListener(&quot;DOMContentLoaded&quot;, () =&gt; {
    alert(&quot;DOM ready!&quot;);
  });
&lt;/script&gt;

&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.3.0/lodash.js&quot;&gt;&lt;/script&gt;

&lt;script&gt;
  alert(&quot;Library loaded, inline script executed&quot;);
&lt;/script&gt;</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    In the example above, we first see “Library loaded…”, and
                    then “DOM ready!” (all scripts are executed).
                  </p>
                  <div class="important important_warn">
                    <div class="important__header">
                      <span class="important__type"
                        >Scripts that don’t block DOMContentLoaded</span
                      >
                    </div>
                    <div class="important__content">
                      <p>There are two exceptions from this rule:</p>
                      <ol>
                        <li>
                          Scripts with the <code>async</code> attribute, that
                          we’ll cover
                          <a href="script-async-defer.html">a bit later</a>,
                          don’t block <code>DOMContentLoaded</code>.
                        </li>
                        <li>
                          Scripts that are generated dynamically with
                          <code>document.createElement('script')</code> and then
                          added to the webpage also don’t block this event.
                        </li>
                      </ol>
                    </div>
                  </div>
                  <h3>
                    <a
                      class="main__anchor"
                      name="domcontentloaded-and-styles"
                      href="onload-ondomcontentloaded.html#domcontentloaded-and-styles"
                      >DOMContentLoaded and styles</a
                    >
                  </h3>
                  <p>
                    External style sheets don’t affect DOM, so
                    <code>DOMContentLoaded</code> does not wait for them.
                  </p>
                  <p>
                    But there’s a pitfall. If we have a script after the style,
                    then that script must wait until the stylesheet loads:
                  </p>
                  <div id="i4ijaa9q3q" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="toolbar codebox__toolbar">
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="show"
                            data-action="run"
                            class="toolbar__button toolbar__button_run"
                          ></a>
                        </div>
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="open in sandbox"
                            target="_blank"
                            data-action="edit"
                            class="toolbar__button toolbar__button_edit"
                          ></a>
                        </div>
                      </div>
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-markup"
                        ><code>&lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;
&lt;script&gt;
  // the script doesn't not execute until the stylesheet is loaded
  alert(getComputedStyle(document.body).marginTop);
&lt;/script&gt;</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    The reason for this is that the script may want to get
                    coordinates and other style-dependent properties of
                    elements, like in the example above. Naturally, it has to
                    wait for styles to load.
                  </p>
                  <p>
                    As <code>DOMContentLoaded</code> waits for scripts, it now
                    waits for styles before them as well.
                  </p>
                  <h3>
                    <a
                      class="main__anchor"
                      name="built-in-browser-autofill"
                      href="onload-ondomcontentloaded.html#built-in-browser-autofill"
                      >Built-in browser autofill</a
                    >
                  </h3>
                  <p>
                    Firefox, Chrome and Opera autofill forms on
                    <code>DOMContentLoaded</code>.
                  </p>
                  <p>
                    For instance, if the page has a form with login and
                    password, and the browser remembered the values, then on
                    <code>DOMContentLoaded</code> it may try to autofill them
                    (if approved by the user).
                  </p>
                  <p>
                    So if <code>DOMContentLoaded</code> is postponed by
                    long-loading scripts, then autofill also awaits. You
                    probably saw that on some sites (if you use browser
                    autofill) – the login/password fields don’t get autofilled
                    immediately, but there’s a delay till the page fully loads.
                    That’s actually the delay until the
                    <code>DOMContentLoaded</code> event.
                  </p>
                  <h2>
                    <a
                      class="main__anchor"
                      name="window-onload"
                      href="onload-ondomcontentloaded.html#window-onload"
                      >window.onload</a
                    >
                  </h2>
                  <p>
                    The <code>load</code> event on the
                    <code>window</code> object triggers when the whole page is
                    loaded including styles, images and other resources. This
                    event is available via the <code>onload</code> property.
                  </p>
                  <p>
                    The example below correctly shows image sizes, because
                    <code>window.onload</code> waits for all images:
                  </p>
                  <div
                    id="a9evb5gcih"
                    data-trusted="1"
                    class="code-example"
                    data-demo-height="200"
                    data-refresh="1"
                  >
                    <div class="codebox code-example__codebox">
                      <div class="toolbar codebox__toolbar">
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="show"
                            data-action="run"
                            class="toolbar__button toolbar__button_run"
                          ></a>
                        </div>
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="open in sandbox"
                            target="_blank"
                            data-action="edit"
                            class="toolbar__button toolbar__button_edit"
                          ></a>
                        </div>
                      </div>
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-markup"
                        ><code>&lt;script&gt;
  window.onload = function() { // can also use window.addEventListener('load', (event) =&gt; {
    alert('Page loaded');

    // image is loaded at this time
    alert(`Image size: ${img.offsetWidth}x${img.offsetHeight}`);
  };
&lt;/script&gt;

&lt;img id=&quot;img&quot; src=&quot;https://en.js.cx/clipart/train.gif?speed=1&amp;cache=0&quot;&gt;</code></pre>
                      </div>
                    </div>
                  </div>
                  <h2>
                    <a
                      class="main__anchor"
                      name="window-onunload"
                      href="onload-ondomcontentloaded.html#window-onunload"
                      >window.onunload</a
                    >
                  </h2>
                  <p>
                    When a visitor leaves the page, the
                    <code>unload</code> event triggers on <code>window</code>.
                    We can do something there that doesn’t involve a delay, like
                    closing related popup windows.
                  </p>
                  <p>The notable exception is sending analytics.</p>
                  <p>
                    Let’s say we gather data about how the page is used: mouse
                    clicks, scrolls, viewed page areas, and so on.
                  </p>
                  <p>
                    Naturally, <code>unload</code> event is when the user leaves
                    us, and we’d like to save the data on our server.
                  </p>
                  <p>
                    There exists a special
                    <code>navigator.sendBeacon(url, data)</code> method for such
                    needs, described in the specification
                    <a href="https://w3c.github.io/beacon/"
                      >https://w3c.github.io/beacon/</a
                    >.
                  </p>
                  <p>
                    It sends the data in background. The transition to another
                    page is not delayed: the browser leaves the page, but still
                    performs <code>sendBeacon</code>.
                  </p>
                  <p>Here’s how to use it:</p>
                  <div id="b961kb76i7" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>let analyticsData = { /* object with gathered data */ };

window.addEventListener(&quot;unload&quot;, function() {
  navigator.sendBeacon(&quot;/analytics&quot;, JSON.stringify(analyticsData));
});</code></pre>
                      </div>
                    </div>
                  </div>
                  <ul>
                    <li>The request is sent as POST.</li>
                    <li>
                      We can send not only a string, but also forms and other
                      formats, as described in the chapter
                      <a href="fetch.html">Fetch</a>, but usually it’s a
                      stringified object.
                    </li>
                    <li>The data is limited by 64kb.</li>
                  </ul>
                  <p>
                    When the <code>sendBeacon</code> request is finished, the
                    browser probably has already left the document, so there’s
                    no way to get server response (which is usually empty for
                    analytics).
                  </p>
                  <p>
                    There’s also a <code>keepalive</code> flag for doing such
                    “after-page-left” requests in
                    <a href="fetch.html">fetch</a> method for generic network
                    requests. You can find more information in the chapter
                    <a href="fetch-api.html">Fetch API</a>.
                  </p>
                  <p>
                    If we want to cancel the transition to another page, we
                    can’t do it here. But we can use another event –
                    <code>onbeforeunload</code>.
                  </p>
                  <h2>
                    <a
                      class="main__anchor"
                      name="window.onbeforeunload"
                      href="onload-ondomcontentloaded.html#window.onbeforeunload"
                      >window.onbeforeunload</a
                    >
                  </h2>
                  <p>
                    If a visitor initiated navigation away from the page or
                    tries to close the window, the
                    <code>beforeunload</code> handler asks for additional
                    confirmation.
                  </p>
                  <p>
                    If we cancel the event, the browser may ask the visitor if
                    they are sure.
                  </p>
                  <p>
                    You can try it by running this code and then reloading the
                    page:
                  </p>
                  <div id="uulxrfmnmw" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="toolbar codebox__toolbar">
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="run"
                            data-action="run"
                            class="toolbar__button toolbar__button_run"
                          ></a>
                        </div>
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="open in sandbox"
                            target="_blank"
                            data-action="edit"
                            class="toolbar__button toolbar__button_edit"
                          ></a>
                        </div>
                      </div>
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>window.onbeforeunload = function() {
  return false;
};</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    For historical reasons, returning a non-empty string also
                    counts as canceling the event. Some time ago browsers used
                    to show it as a message, but as the
                    <a href="https://html.spec.whatwg.org/#unloading-documents"
                      >modern specification</a
                    >
                    says, they shouldn’t.
                  </p>
                  <p>Here’s an example:</p>
                  <div id="ua8v467k7h" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="toolbar codebox__toolbar">
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="run"
                            data-action="run"
                            class="toolbar__button toolbar__button_run"
                          ></a>
                        </div>
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="open in sandbox"
                            target="_blank"
                            data-action="edit"
                            class="toolbar__button toolbar__button_edit"
                          ></a>
                        </div>
                      </div>
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>window.onbeforeunload = function() {
  return &quot;There are unsaved changes. Leave now?&quot;;
};</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    The behavior was changed, because some webmasters abused
                    this event handler by showing misleading and annoying
                    messages. So right now old browsers still may show it as a
                    message, but aside of that – there’s no way to customize the
                    message shown to the user.
                  </p>
                  <h2>
                    <a
                      class="main__anchor"
                      name="readystate"
                      href="onload-ondomcontentloaded.html#readystate"
                      >readyState</a
                    >
                  </h2>
                  <p>
                    What happens if we set the
                    <code>DOMContentLoaded</code> handler after the document is
                    loaded?
                  </p>
                  <p>Naturally, it never runs.</p>
                  <p>
                    There are cases when we are not sure whether the document is
                    ready or not. We’d like our function to execute when the DOM
                    is loaded, be it now or later.
                  </p>
                  <p>
                    The <code>document.readyState</code> property tells us about
                    the current loading state.
                  </p>
                  <p>There are 3 possible values:</p>
                  <ul>
                    <li>
                      <code>&quot;loading&quot;</code> – the document is
                      loading.
                    </li>
                    <li>
                      <code>&quot;interactive&quot;</code> – the document was
                      fully read.
                    </li>
                    <li>
                      <code>&quot;complete&quot;</code> – the document was fully
                      read and all resources (like images) are loaded too.
                    </li>
                  </ul>
                  <p>
                    So we can check <code>document.readyState</code> and setup a
                    handler or execute the code immediately if it’s ready.
                  </p>
                  <p>Like this:</p>
                  <div id="2wf2g885di" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>function work() { /*...*/ }

if (document.readyState == 'loading') {
  // still loading, wait for the event
  document.addEventListener('DOMContentLoaded', work);
} else {
  // DOM is ready!
  work();
}</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    There’s also the <code>readystatechange</code> event that
                    triggers when the state changes, so we can print all these
                    states like this:
                  </p>
                  <div id="ore79maiuc" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="toolbar codebox__toolbar">
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="run"
                            data-action="run"
                            class="toolbar__button toolbar__button_run"
                          ></a>
                        </div>
                        <div class="toolbar__tool">
                          <a
                            href="onload-ondomcontentloaded.html#"
                            title="open in sandbox"
                            target="_blank"
                            data-action="edit"
                            class="toolbar__button toolbar__button_edit"
                          ></a>
                        </div>
                      </div>
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-javascript"
                        ><code>// current state
console.log(document.readyState);

// print state changes
document.addEventListener('readystatechange', () =&gt; console.log(document.readyState));</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    The <code>readystatechange</code> event is an alternative
                    mechanics of tracking the document loading state, it
                    appeared long ago. Nowadays, it is rarely used.
                  </p>
                  <p>Let’s see the full events flow for the completeness.</p>
                  <p>
                    Here’s a document with <code>&lt;iframe&gt;</code>,
                    <code>&lt;img&gt;</code> and handlers that log events:
                  </p>
                  <div id="wff3wh8a57" data-trusted="1" class="code-example">
                    <div class="codebox code-example__codebox">
                      <div class="codebox__code" data-code="1">
                        <pre
                          class="line-numbers language-markup"
                        ><code>&lt;script&gt;
  log('initial readyState:' + document.readyState);

  document.addEventListener('readystatechange', () =&gt; log('readyState:' + document.readyState));
  document.addEventListener('DOMContentLoaded', () =&gt; log('DOMContentLoaded'));

  window.onload = () =&gt; log('window onload');
&lt;/script&gt;

&lt;iframe src=&quot;iframe.html&quot; onload=&quot;log('iframe onload')&quot;&gt;&lt;/iframe&gt;

&lt;img src=&quot;http://en.js.cx/clipart/train.gif&quot; id=&quot;img&quot;&gt;
&lt;script&gt;
  img.onload = () =&gt; log('img onload');
&lt;/script&gt;</code></pre>
                      </div>
                    </div>
                  </div>
                  <p>
                    The working example is
                    <a href="https://plnkr.co/edit/L0Cijdek96r72cGe?p=preview"
                      >in the sandbox</a
                    >.
                  </p>
                  <p>The typical output:</p>
                  <ol>
                    <li>[1] initial readyState:loading</li>
                    <li>[2] readyState:interactive</li>
                    <li>[2] DOMContentLoaded</li>
                    <li>[3] iframe onload</li>
                    <li>[4] img onload</li>
                    <li>[4] readyState:complete</li>
                    <li>[4] window onload</li>
                  </ol>
                  <p>
                    The numbers in square brackets denote the approximate time
                    of when it happens. Events labeled with the same digit
                    happen approximately at the same time (± a few ms).
                  </p>
                  <ul>
                    <li>
                      <code>document.readyState</code> becomes
                      <code>interactive</code> right before
                      <code>DOMContentLoaded</code>. These two things actually
                      mean the same.
                    </li>
                    <li>
                      <code>document.readyState</code> becomes
                      <code>complete</code> when all resources (<code
                        >iframe</code
                      >
                      and <code>img</code>) are loaded. Here we can see that it
                      happens in about the same time as
                      <code>img.onload</code> (<code>img</code> is the last
                      resource) and <code>window.onload</code>. Switching to
                      <code>complete</code> state means the same as
                      <code>window.onload</code>. The difference is that
                      <code>window.onload</code> always works after all other
                      <code>load</code> handlers.
                    </li>
                  </ul>
                  <h2>
                    <a
                      class="main__anchor"
                      name="summary"
                      href="onload-ondomcontentloaded.html#summary"
                      >Summary</a
                    >
                  </h2>
                  <p>Page load events:</p>
                  <ul>
                    <li>
                      The <code>DOMContentLoaded</code> event triggers on
                      <code>document</code> when the DOM is ready. We can apply
                      JavaScript to elements at this stage.
                      <ul>
                        <li>
                          Script such as
                          <code>&lt;script&gt;...&lt;/script&gt;</code> or
                          <code
                            >&lt;script
                            src=&quot;...&quot;&gt;&lt;/script&gt;</code
                          >
                          block DOMContentLoaded, the browser waits for them to
                          execute.
                        </li>
                        <li>
                          Images and other resources may also still continue
                          loading.
                        </li>
                      </ul>
                    </li>
                    <li>
                      The <code>load</code> event on
                      <code>window</code> triggers when the page and all
                      resources are loaded. We rarely use it, because there’s
                      usually no need to wait for so long.
                    </li>
                    <li>
                      The <code>beforeunload</code> event on
                      <code>window</code> triggers when the user wants to leave
                      the page. If we cancel the event, browser asks whether the
                      user really wants to leave (e.g we have unsaved changes).
                    </li>
                    <li>
                      The <code>unload</code> event on
                      <code>window</code> triggers when the user is finally
                      leaving, in the handler we can only do simple things that
                      do not involve delays or asking a user. Because of that
                      limitation, it’s rarely used. We can send out a network
                      request with <code>navigator.sendBeacon</code>.
                    </li>
                    <li>
                      <code>document.readyState</code> is the current state of
                      the document, changes can be tracked in the
                      <code>readystatechange</code> event:
                      <ul>
                        <li><code>loading</code> – the document is loading.</li>
                        <li>
                          <code>interactive</code> – the document is parsed,
                          happens at about the same time as
                          <code>DOMContentLoaded</code>, but before it.
                        </li>
                        <li>
                          <code>complete</code> – the document and resources are
                          loaded, happens at about the same time as
                          <code>window.onload</code>, but before it.
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </article>
            </div>
            <div class="page__nav-wrap">
              <a
                class="page__nav page__nav_prev"
                href="loading.html"
                data-tooltip="Document and resource loading"
                ><span class="page__nav-text"
                  ><span class="page__nav-text-shortcut"></span></span
                ><span class="page__nav-text-alternate"
                  >Previous lesson</span
                ></a
              ><a
                class="page__nav page__nav_next"
                href="script-async-defer.html"
                data-tooltip="Scripts: async, defer"
                ><span class="page__nav-text"
                  ><span class="page__nav-text-shortcut"></span></span
                ><span class="page__nav-text-alternate">Next lesson</span></a
              >
            </div>
            <div class="article-tablet-foot tablet-only">
              <div class="article-tablet-foot__layout">
                <div class="share-icons">
                  <span class="share-icons__title">Share</span
                  ><a
                    class="share share_tw"
                    s%3A%2F%2Fjavascript.info%2Fonload-ondomcontentloaded"
                    rel="nofollow"
                  ></a
                  ><a
                    class="share share_fb"
                    href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A%2F%2Fjavascript.info%2Fonload-ondomcontentloaded"
                    rel="nofollow"
                  ></a>
                </div>
                <div class="article-tablet-foot__map">
                  <a
                    class="map"
                    href="tutorial/map.html"
                    data-action="tutorial-map"
                    ><span class="map__text">Tutorial map</span></a
                  >
                </div>
              </div>
            </div>
            
                  <a
                    href="onload-ondomcontentloaded.html#comments"
                    name="comments"
                    >Comments</a
                  >
                </h2>
                <div class="comments__read-before">
                  <span class="comments__read-before-link"
                    >read this before commenting…</span
                  >
                  <div class="comments__read-before-popup">
                    <div class="comments__read-before-popup-i">
                      <ul>
                        <li>
                          If you have suggestions what to improve - please
                          <a
                            href="https://github.com/javascript-tutorial/en.javascript.info/issues/new"
                            >submit a GitHub issue</a
                          >
                          or a pull request instead of commenting.
                        </li>
                        <li>
                          If you can't understand something in the article –
                          please elaborate.
                        </li>
                        <li>
                          To insert few words of code, use the
                          <code>&lt;code&gt;</code> tag, for several lines –
                          wrap them in <code>&lt;pre&gt;</code> tag, for more
                          than 10 lines – use a sandbox (<a
                            href="https://plnkr.co/edit/?p=preview"
                            >plnkr</a
                          >, <a href="https://jsbin.com">jsbin</a>,
                          <a href="http://codepen.io">codepen</a>…)
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <div id="disqus_thread"></div>
              <script>
                var disqus_config = function () {
                  if (!this.page) this.page = {};
                  Object.assign(this.page, {
                    url: "https:\/\/javascript.info\/onload-ondomcontentloaded",
                    identifier: "\/onload-ondomcontentloaded",
                  });
                };
              </script>
              <script>
                var disqus_shortname = "javascriptinfo";
              </script>
              <script>
                var disqus_enabled = true;
              </script>
            </div>
          </main>
        </div>

                <nav class="sidebar__navigation">
                  <ul class="sidebar__navigation-links">
                    <li class="sidebar__navigation-link">
                      <a class="sidebar__link" href="loading.html"
                        >Document and resource loading</a
                      >
                    </li>
                  </ul>
                </nav>
                <h4 class="sidebar__section-title">Lesson navigation</h4>
                <nav class="sidebar__navigation">
                  <ul class="sidebar__navigation-links">
                    <li class="sidebar__navigation-link">
                   onload-ondomcontentloaded.html#domcontentloaded"
                        >DOMContentLoaded</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   onload-ondomcontentloaded.html#window-onload"
                        >window.onload</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   onload-ondomcontentloaded.html#window-onunload"
                        >window.onunload</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   onload-ondomcontentloaded.html#window.onbeforeunload"
                        >window.onbeforeunload</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   onload-ondomcontentloaded.html#readystate"
                        >readyState</a
                      >
                    </li>
                    <li class="sidebar__navigation-link">
                   onload-ondomcontentloaded.html
                  </ul>
                </nav>
                <nav class="sidebar__navigation">
                  <ul class="sidebar__navigation-links">
                    <li class="sidebar__navigation-link">
                   onload-ondomcontentloaded.html#comments"
                        >Comments</a
                      >
                    </li>
                  </ul>
                </nav>
              </div>
           <a
                  class="share share_tw sidebar__share"
                  s%3A%2F%2Fjavascript.info%2Fonload-ondomcontentloaded"
                  rel="nofollow"
                ></a
                ><a
                  class="share share_fb sidebar__share"
                  href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Fjavascript.info%2Fonload-ondomcontentloaded"
                  rel="nofollow"
                ></a>
                <a
                  class="sidebar__link"
                  href="https://github.com/javascript-tutorial/en.javascript.info/blob/master/2-ui/5-loading/01-onload-ondomcontentloaded"
                  rel="nofollow"
                  >Edit on GitHub</a
                >
              </div>
              <div class="sidebar__section" id="sponsorBar">
                <div class="sidebar__section-title" id="sponsorBarTitle"></div>
                <div id="sponsorBarContent"></div>
                <script>
                  window.initSponsorBar();
                </script>
      <ul class="page-footer__list">
        <li class="page-footer__item page-footer__item_copy">
          ©&nbsp;2007—2021&nbsp; Ilya Kantor
        </li>
        <li class="page-footer__item page-footer__item_about">
          <a class="page-footer__link" href="about.html">about the project</a>
        </li>
        <li class="page-footer__item page-footer__item_contact">
          <a class="page-footer__link" href="about.html#contact-us"
            >contact us</a
          >
        </li>
        <li class="page-footer__item page-footer__item_terms">
          <a class="page-footer__link" href="terms.html">terms of usage</a>
        </li>
        <li class="page-footer__item page-footer__item_privacy">
          <a class="page-footer__link" href="privacy.html">privacy policy</a>
        </li>
      </ul>
    </div>
  </body>
</html>
